{% extends "baseViews.html" %} {% block title %}Training{% endblock %} <!-- Extiende el base-html. Será exactamente igual excepto el título-->
{% block links %}
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js" integrity="sha512-odNmoc1XJy5x1TMVMdC7EMs3IVdItLPlCeL5vSUPN2llYKMJ2eByTTAIiiuqLg+GdNr9hF6z81p27DArRFKT7A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{% endblock %}
{% block content %}
    <p>&emsp;</p>
    <h1 align="left"><b>TRAINER</b></h1>
    <p>&emsp;</p>
    <p>
    In this section you will have the opportunity to train different models according to the parameters of your choice.
    </p>
    <p>
    You can get more information about the selected dataset in this link:
    </p>

    {% if datasetTL == "Cat and Dog nº1" %}
        <a href="https://www.kaggle.com/datasets/tongpython/cat-and-dog">https://www.kaggle.com/datasets/tongpython/cat-and-dog</a>
    {% elif datasetTL == "Cat and Dog nº2" %}
        <a href="https://www.kaggle.com/datasets/d4rklucif3r/cat-and-dogs">https://www.kaggle.com/datasets/d4rklucif3r/cat-and-dogs</a>
    {% elif datasetTL == "Cat and Dog nº3" %}
        <a href="https://www.kaggle.com/datasets/chetankv/dogs-cats-images">https://www.kaggle.com/datasets/chetankv/dogs-cats-images</a>
    {% endif %}
  
    <hr>
    <p>&emsp;</p>

    <div align="center">
        <h2><b>TRAINING...</b></h2>
        <p>&emsp;</p>

        <p>Here below are shown 2 images belonging to the dataset:</p>
        <p>&emsp;</p>

        {% if datasetTL == "Cat and Dog nº1" %}
            <div class="row align-items-center">
                <div class="column" style="width: 20%;">
                </div>
                <div class="column" style="width: 20%;">
                <img src="../static/images/dataset1cat.jpg" alt="img1" style="width: 250px; height: 250px;">
                </div>
                <div class="column" style="width: 20%;">
                </div>
                <div class="column" style="width: 20%;">
                <img src="../static/images/dataset1_dog.jpg" alt="img2" style="width: 250px; height: 250px;">
                </div>
                <div class="column" style="width: 20%;">
                </div>
            </div>
        {% elif datasetTL == "Cat and Dog nº2" %}
            <div class="row align-items-center">
                <div class="column" style="width: 20%;">
                </div>
                <div class="column" style="width: 20%;">
                <img src="../static/images/dataset2cat.jpg" alt="img1" style="width: 250px; height: 250px;">
                </div>
                <div class="column" style="width: 20%;">
                </div>
                <div class="column" style="width: 20%;">
                <img src="../static/images/dataset2dog.jpg" alt="img2" style="width: 250px; height: 250px;">
                </div>
                <div class="column" style="width: 20%;">
                </div>
            </div>
        {% elif datasetTL == "Cat and Dog nº3" %}
        <div class="row align-items-center">
            <div class="column" style="width: 20%;">
            </div>
            <div class="column" style="width: 20%;">
            <img src="../static/images/dataset3cat.jpg" alt="img1" style="width: 250px; height: 250px;">
            </div>
            <div class="column" style="width: 20%;">
            </div>
            <div class="column" style="width: 20%;">
            <img src="../static/images/dataset3_dog.jpg" alt="img2" style="width: 250px; height: 250px;">
            </div>
            <div class="column" style="width: 20%;">
            </div>
        </div>
        {% endif %}
        <p>&emsp;</p>
        <p>&emsp;</p>

        <hr>
        <h4><b>OPTIONS CHOSEN</b></h4>
        <p>&emsp;</p>

        {% if svmTL == 'YES' %}
        <div class="row">

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>DATASET</h5>
                <p>{{ datasetTL }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>WORK WITH</h5>
                <p>{{ workWithTL }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>MODE</h5>
                <p>Classical</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>
        </div>

        <p>&ensp;</p>

        <div class="row">

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>MODEL FOR TRANSFER LEARNING</h5>
                <p>{{ modelTL }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>PRETRAINED</h5>
                <p>YES</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>SVM AS LAST LAYER</h5>
                <p>YES</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>
        </div>
    

        <p>&ensp;</p>
        <h5>SVM PARAMETERS</h5>
        <div class="row">

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 80%;">
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th scope="col">C (REGULARIZATION)</th>
                        <th scope="col">KERNEL</th>
                        <th scope="col">GAMMA</th>
                        <th scope="col">VALIDATION SET SIZE</th>
                        <th scope="col">SHUFFLE WHEN SPLITTING IT</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>{{ cRegularizationSVM }}</td>
                        <td>{{ kernelSVM }}</td>
                        <td>{{ gammaSVM }}</td>
                        <td>{{ validationSet_size }}</td>
                        <td>{{ shuffleSVM }}</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="column" style="width: 10%;">
            </div>
        </div>

        <p>&ensp;</p>

        <div class="row">

            <div class="column" style="width: 20%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>SAVE MODEL</h5>
                {% if saveModel is not none %}
                <p>YES</p>
                {% else %}
                <p>NO</p>
                {% endif %}
            </div>

            <div class="column" style="width: 20%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>GENERATE PDF REPORT</h5>
                {% if generatePDF is not none %}
                <p>YES</p>
                {% else %}
                <p>NO</p>
                {% endif %}
            </div>

            <div class="column" style="width: 20%;">
            </div>
        </div>


        {% elif modeTL == 'Quantum' %}

        <div class="row">

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>DATASET</h5>
                <p>{{ datasetTL }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>WORK WITH</h5>
                <p>{{ workWithTL }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>MODE</h5>
                <p>Quantum</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>
        </div>

        <p>&ensp;</p>

        <div class="row">

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>TYPE OF QUANTUM MODEL</h5>
                <p>{{ typeQuantum }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
            </div>

            <div class="column" style="width: 10%;">
            </div>
        </div>

        <p>&ensp;</p>

        <div class="row">

            <div class="column" style="width: 20%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>SAVE MODEL</h5>
                {% if saveModel is not none %}
                <p>YES</p>
                {% else %}
                <p>NO</p>
                {% endif %}
            </div>

            <div class="column" style="width: 20%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>GENERATE PDF REPORT</h5>
                {% if generatePDF is not none %}
                <p>YES</p>
                {% else %}
                <p>NO</p>
                {% endif %}
            </div>

            <div class="column" style="width: 20%;">
            </div>
        </div>

        {% else %}

        <div class="row">

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>DATASET</h5>
                <p>{{ datasetTL }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>WORK WITH</h5>
                <p>{{ workWithTL }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>MODE</h5>
                <p>{{ modeTL }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>
        </div>

        <p>&ensp;</p>

        <div class="row">

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>MODEL FOR TRANSFER LEARNING</h5>
                <p>{{ modelTL }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>PRETRAINED</h5>
                <p>{{ pretrainedTL }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>SVM AS LAST LAYER</h5>
                <p>{{ svmTL }}</p>
            </div>

            <div class="column" style="width: 10%;">
            </div>
        </div>
    

        <p>&ensp;</p>
        <h5>HYPERPARAMETERS</h5>
        <div class="row">

            <div class="column" style="width: 15%;">
            </div>

            <div class="column" style="width: 70%;">
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th scope="col">OPTIMIZER</th>
                        <th scope="col">VALIDATION SET SIZE</th>
                        <th scope="col">LEARNING RATE</th>
                        <th scope="col">NUMBER OF EPOCHS</th>
                        <th scope="col">BATCH SIZE</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>{{ optimizerTL }}</td>
                        <td>{{ validationSet_size }}</td>
                        <td>{{ lr }}</td>
                        <td>{{ num_epochs }}</td>
                        <td>{{ batch_size }}</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="column" style="width: 15%;">
            </div>
        </div>

        <p>&ensp;</p>

        <div class="row">

            <div class="column" style="width: 20%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>SAVE MODEL</h5>
                {% if saveModel is not none %}
                <p>YES</p>
                {% else %}
                <p>NO</p>
                {% endif %}
            </div>

            <div class="column" style="width: 20%;">
            </div>

            <div class="column" style="width: 20%;">
                <h5>GENERATE PDF REPORT</h5>
                {% if generatePDF is not none %}
                <p>YES</p>
                {% else %}
                <p>NO</p>
                {% endif %}
            </div>

            <div class="column" style="width: 20%;">
            </div>
        </div>
        {% endif %}

        <p>&emsp;</p>
        <p>&emsp;</p>
        <hr>
        <h4><b>TRAINING PROCESS</b></h4>
        <p>&emsp;</p>

        {% if svmTL == 'YES' %}
            <div align="center" style="width: 53%;"> <!-- con una anchura del 53% salen cada epoca en una linea diferente -->
                <p id="updateFlag"></p>
            </div>
            <div id="restoDelContenido1">

            </div>
            
            <div class="container" id="containerGraphs" style="display: none;">
                <div class="row">
                    <div class="col">
                        <img src ="{{ url_for('static',filename='images/graphAccuracyTrainer.png') }}" class= "img-fluid" id="graphAccuracy"/>
                    </div>
                    <div class="col" id="graphLoss">
                        <img src ="{{ url_for('static',filename='images/graphLossesTrainer.png') }}" class= "img-fluid" id="graphLosses"/>
                    </div>
                </div>
            </div>
            
            <div id="restoDelContenido2">

            </div>

        {% elif modeTL == "Quantum" %}
            <div align="center" style="width: 53%;"> <!-- con una anchura del 53% salen cada epoca en una linea diferente -->
                <p id="updateFlag"></p>
            </div>
            <div id="restoDelContenido1">

            </div>
            
            <div class="container" id="containerGraphs" style="display: none;">
                <div class="row">
                    <div class="col">
                        <img src ="{{ url_for('static',filename='images/graphAccuracyTrainer.png') }}" class= "img-fluid" id="graphAccuracy"/>
                    </div>
                    <div class="col" id="graphLoss">
                        <img src ="{{ url_for('static',filename='images/graphLossesTrainer.png') }}" class= "img-fluid" id="graphLosses"/>
                    </div>
                </div>
            </div>
            
            <div id="restoDelContenido2">

            </div>

        {% else %}
            <div align="center" style="width: 53%;"> <!-- con una anchura del 53% salen cada epoca en una linea diferente -->
                <p id="updateFlag"></p>
            </div>
            <div id="restoDelContenido1">

            </div>
            
            <div class="container" id="containerGraphs" style="display: none;">
                <div class="row">
                    <div class="col">
                        <img src ="{{ url_for('static',filename='images/graphAccuracyTrainer.png') }}" class= "img-fluid" id="graphAccuracy"/>
                    </div>
                    <div class="col" id="graphLoss">
                        <img src ="{{ url_for('static',filename='images/graphLossesTrainer.png') }}" class= "img-fluid" id="graphLosses"/>
                    </div>
                </div>
            </div>
            
            <div id="restoDelContenido2">

            </div>
        {% endif %}
            
            
        
        
        <script>
      
          function getRandomNumber() {
      
              url = "/update_flag";
      
              axios.get(url)
              .then(function(response) {
      
                  // The data will all be returned as a JSON object
                  // We can access the data by using the data property of the response object
      
                  document.getElementById('updateFlag').innerHTML = response.data.updateFlag;
                  document.getElementById('restoDelContenido1').innerHTML = response.data.restoDelContenido1;
                  document.getElementById('restoDelContenido2').innerHTML = response.data.restoDelContenido2;
                  flagShowGraphs = response.data.flagShowGraphs;
                  var containerGraphs = document.getElementById("containerGraphs");
                  var actualGraphImageName = response.data.actualGraphImageName
                  console.log(actualGraphImageName)

                  
                  if (flagShowGraphs == true){ //si ya acabo el entrenamiento se muestran los graficos
                    document.getElementById("graphAccuracy").src = "{{ url_for('static',filename='images/graphAccuracyTrainer.png') }}";
                    containerGraphs.style.display = "block";
                    //containerGraphs.innerHTML = <div class="row"><div class="col"><img src ="{{ url_for('static',filename='images/graphAccuracyTrainer.png') }}" class= "img-fluid" id="graphLosses"/></div><div class="col" id="graphLoss"><img src ="{{ url_for('static',filename='images/graphLossesTrainer.png') }}" class= "img-fluid" id="graphLosses"/></div></div>

                    
                    const a = String(Math.floor(Math.random() * (1000000 - 1)) + 1);
                    //let img = document.createElement('img');
                    //img.src = "{{ url_for('static',filename='images/graphAccuracyTrainer.png?dummy=1252778') }}"
                    //img.className = "img-fluid"
                    //document.getElementById("graphAccuracy").innerHTML = <img src ="{{ url_for('static',filename='images/graphAccuracyTrainer.png?dummy=1252778') }}" class= "img-fluid"/>;
                    
                  }

                  

                  
              })
              .catch(function(error) {
                  console.log(error);
              });
          }
      
          // This calls the function getRandomNumber() every 2 seconds
          var intervalID = window.setInterval(getRandomNumber, 1000);
      
        </script>

            

        
        



    </div>



    <p>&emsp;</p>
    <p>&emsp;</p>
    <p>&emsp;</p>
    






  {% endblock %}